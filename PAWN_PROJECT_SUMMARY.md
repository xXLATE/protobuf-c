# protobuf-pawn Project Summary

## Описание
Проект protobuf-pawn представляет собой адаптацию protobuf-c для генерации кода на языке Pawn вместо C. Это плагин для Protocol Buffers compiler (protoc), который генерирует Pawn-совместимые include файлы (.inc) из .proto определений.

## Архитектура проекта

### Основные компоненты

#### 1. Точка входа (`main.cc`)
- Регистрирует генератор как `protoc-gen-pawn`
- Поддерживает как плагин режим, так и standalone режим
- Инициализирует PawnGenerator

#### 2. Основной генератор (`pawn_generator.cc/.h`)
- Класс `PawnGenerator` - наследник `google::protobuf::compiler::CodeGenerator`
- Генерирует .pb-pawn.inc файлы вместо .pb-c.h/.pb-c.c
- Координирует работу всех подгенераторов

#### 3. Файловый генератор (`pawn_file.cc/.h`)
- Класс `FileGenerator` - отвечает за генерацию полного .inc файла
- Создает include guards в Pawn стиле
- Обрабатывает зависимости между файлами
- Организует секции: enums, messages, services

#### 4. Генератор enum (`pawn_enum.cc/.h`)
- Класс `EnumGenerator` - генерирует константы для enum
- Формат: `#define ENUM_NAME__VALUE_NAME number`
- Пример: `#define STATUS__ACTIVE 1`

#### 5. Генератор сообщений (`pawn_message.cc/.h`)
- Класс `MessageGenerator` - генерирует константы полей сообщений
- Формат: `#define MESSAGE_NAME__FIELD_NAME_FIELD number`
- Пример: `#define USER__ID_FIELD 1`
- Поддерживает вложенные типы

#### 6. Генератор сервисов (`pawn_service.cc/.h`)
- Класс `ServiceGenerator` - генерирует константы методов сервисов
- Формат: `#define SERVICE_NAME__METHOD_NAME_METHOD number`
- Пример: `#define USER_SERVICE__GET_USER_METHOD 1`

#### 7. Вспомогательные функции (`pawn_helpers.cc/.h`)
- Утилиты для преобразования имен
- Функции работы со строками
- Специфичные для Pawn преобразования

## Ключевые отличия от protobuf-c

### 1. Упрощенный подход
- Нет сложных структур C
- Только простые #define константы
- Никаких runtime библиотек

### 2. Pawn-специфичные особенности
- Include guards в стиле `#if defined _filename_included`
- Расширение .pb-pawn.inc вместо .pb-c.h/.pb-c.c
- Только целочисленные константы (типобезопасность Pawn)

### 3. Удаленные компоненты
- Убраны Field generators (c_*_field.*)
- Убраны Extensions (не нужны для Pawn)
- Убраны сложные дескрипторы и runtime поддержка

## Примеры генерируемого кода

### Входной .proto файл:
```protobuf
syntax = "proto3";
package test;

enum Status {
  UNKNOWN = 0;
  ACTIVE = 1;
}

message User {
  int32 id = 1;
  string name = 2;
  Status status = 3;
}
```

### Выходной .pb-pawn.inc файл:
```pawn
/* Generated by the protocol buffer compiler for Pawn.  DO NOT EDIT! */
/* Generated from: example.proto */

#if defined _example_proto_included
  #endinput
#endif
#define _example_proto_included

/* --- enums --- */

/* TEST__STATUS values */
#define TEST__STATUS__UNKNOWN 0
#define TEST__STATUS__ACTIVE 1

/* --- messages --- */

/* TEST__USER field numbers */
#define TEST__USER__ID_FIELD 1
#define TEST__USER__NAME_FIELD 2
#define TEST__USER__STATUS_FIELD 3

/* End of example.proto */
```

## Статус реализации

### ✅ Реализовано:
- [x] Базовая архитектура генератора
- [x] Генерация enum констант
- [x] Генерация констант полей сообщений
- [x] Генерация констант методов сервисов
- [x] Обработка зависимостей между файлами
- [x] Pawn-совместимые include guards
- [x] Система сборки (Makefile.am)

### ❌ Не требуется для Pawn:
- Field generators для различных типов данных
- Extensions support
- Runtime дескрипторы
- Сложные структуры данных C

## Файловая структура проекта

```
protoc-gen-pawn/
├── main.cc                    # Точка входа
├── pawn_generator.h/.cc       # Основной генератор
├── pawn_file.h/.cc           # Файловый генератор
├── pawn_enum.h/.cc           # Генератор enum
├── pawn_message.h/.cc        # Генератор сообщений
├── pawn_service.h/.cc        # Генератор сервисов
├── pawn_helpers.h/.cc        # Вспомогательные функции
└── compat.h                  # Совместимость

Makefile.am                   # Система сборки (обновлен)
build_protoc_gen_pawn.sh      # Скрипт сборки
test_*.proto                  # Тестовые файлы
expected_*.pb-pawn.inc        # Ожидаемые результаты
protobuf-pawn-README.md       # Документация
```

## Сборка и использование

### Требования:
- C++17 компилятор
- protobuf development libraries
- protoc

### Сборка:
```bash
# Linux/Unix
chmod +x build_protoc_gen_pawn.sh
./build_protoc_gen_pawn.sh

# Или через autotools (если настроено)
./configure
make
```

### Использование:
```bash
protoc --plugin=protoc-gen-pawn=./build/protoc-gen-pawn --pawn_out=. example.proto
```

## Следующие шаги

1. **Тестирование**: Компиляция и тестирование в Linux среде
2. **Отладка**: Проверка правильности генерируемого кода
3. **Оптимизация**: Улучшение производительности и качества кода
4. **Документация**: Расширение документации с примерами

## Заключение

Проект protobuf-pawn успешно адаптирует архитектуру protobuf-c для языка Pawn, предоставляя простой и эффективный способ генерации констант из протобуф определений. Основная функциональность реализована и готова к тестированию. 